
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Jira E-Mail Vorschau Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/eclipse.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; height: 100vh; display: flex; }
        #leftPanel, #rightPanel { padding: 10px; overflow: auto; }
        #leftPanel { width: 50%; resize: horizontal; overflow: auto; border-right: 2px solid #ccc; }
        #rightPanel { flex-grow: 1; }
        textarea { width: 100%; height: 150px; resize: vertical; }
        iframe { width: 100%; height: 90%; border: 1px solid #ccc; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 5px; }
        input[type="text"] { width: 100%; }
    </style>
</head>
<body>
    <div id="leftPanel">
        <h2>E-Mail Konfiguration</h2>
        <label for="headerInput">Kopfzeile</label>
        <textarea id="headerInput"></textarea>
        <label for="footerInput">Fußzeile</label>
        <textarea id="footerInput"></textarea>
        <label for="contentInput">E-Mail-Inhalt</label>
        <textarea id="contentInput"></textarea>
        <button onclick="generatePreview()">Vorschau generieren</button>

        <h3>Platzhalter-Konfiguration</h3>
        <table id="placeholderTable">
            <thead>
                <tr><th>Platzhalter</th><th>Name</th><th>Beispielwert</th><th>Aktion</th></tr>
            </thead>
            <tbody></tbody>
        </table>
        <input type="text" id="phInput" placeholder="Platzhalter">
        <input type="text" id="nameInput" placeholder="Name">
        <input type="text" id="valueInput" placeholder="Beispielwert">
        <button onclick="addOrUpdatePlaceholder()">Hinzufügen / Aktualisieren</button>
        <button onclick="exportPlaceholders()">Exportieren</button>
        <button onclick="document.getElementById('importFile').click()">Importieren</button>
        <input type="file" id="importFile" style="display:none">
    </div>
    <div id="rightPanel">
        <h2>Vorschau</h2>
        <iframe id="previewFrame"></iframe>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/htmlmixed/htmlmixed.min.js"></script>
    <script>
        function initCodeMirror(id) {
            return CodeMirror.fromTextArea(document.getElementById(id), {
                lineNumbers: true,
                mode: "htmlmixed",
                theme: "eclipse"
            });
        }

        let cmHeader, cmFooter, cmContent;
        window.addEventListener("load", function() {
            cmHeader = initCodeMirror("headerInput");
            cmFooter = initCodeMirror("footerInput");
            cmContent = initCodeMirror("contentInput");
            loadPlaceholders();
        });

        function generatePreview() {
            let header = cmHeader.getValue();
            let footer = cmFooter.getValue();
            let content = cmContent.getValue();
            let fullHtml = header + replacePlaceholders(content) + footer;
            let blob = new Blob([fullHtml], {type: "text/html"});
            let url = URL.createObjectURL(blob);
            document.getElementById("previewFrame").src = url;
        }

        function replacePlaceholders(html) {
            let data = JSON.parse(localStorage.getItem("placeholderData") || "{}");
            for (let key in data) {
                html = html.replaceAll(key, data[key].value);
            }
            return html;
        }

        function loadPlaceholders() {
            let data = JSON.parse(localStorage.getItem("placeholderData") || "{}");
            let tbody = document.querySelector("#placeholderTable tbody");
            tbody.innerHTML = "";
            for (let key in data) {
                let row = document.createElement("tr");
                row.innerHTML = `<td>${key}</td><td>${data[key].name}</td><td>${data[key].value}</td>
                                 <td><button onclick="editPlaceholder('${key}')">Bearbeiten</button></td>`;
                tbody.appendChild(row);
            }
        }

        function addOrUpdatePlaceholder() {
            let key = document.getElementById("phInput").value;
            let name = document.getElementById("nameInput").value;
            let value = document.getElementById("valueInput").value;
            if (!key) return;
            let data = JSON.parse(localStorage.getItem("placeholderData") || "{}");
            data[key] = {name: name, value: value};
            localStorage.setItem("placeholderData", JSON.stringify(data));
            loadPlaceholders();
        }

        function editPlaceholder(key) {
            let data = JSON.parse(localStorage.getItem("placeholderData") || "{}");
            document.getElementById("phInput").value = key;
            document.getElementById("nameInput").value = data[key].name;
            document.getElementById("valueInput").value = data[key].value;
        }

        function exportPlaceholders() {
            let data = localStorage.getItem("placeholderData") || "{}";
            let blob = new Blob([data], {type: "application/json"});
            let url = URL.createObjectURL(blob);
            let a = document.createElement("a");
            a.href = url;
            a.download = "platzhalterliste.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        document.getElementById("importFile").addEventListener("change", function(event) {
            let file = event.target.files[0];
            if (!file) return;
            let reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data = JSON.parse(e.target.result);
                    localStorage.setItem("placeholderData", JSON.stringify(data));
                    loadPlaceholders();
                } catch (err) {
                    alert("Fehler beim Importieren der JSON-Datei.");
                }
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>
